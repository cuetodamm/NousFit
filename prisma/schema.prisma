generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Usuario {
  id              String       @id @default(uuid())
  nombre          String
  apellidos       String
  correo          String       @unique
  contraseña      String
  noCuenta        String       @unique
  carrera         String
  turno           String
  genero          String
  numeroTutor     String?
  datosBiometricos Json?
  imagenDetectada Json?
  esAdmin         Boolean      @default(false)
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt
  
  // Relaciones
  documentos      Documento[]
  logs            Log[]
  asistencias     Asistencia[] // <--- NUEVO: Relación con asistencias
}

// --- NUEVO MODELO PARA ASISTENCIA ---
model Asistencia {
  id        String   @id @default(uuid())
  usuarioId String
  fecha     DateTime @default(now())
  
  // Relación para traer los datos del alumno (nombre, carrera, etc.)
  usuario   Usuario  @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
}

model Documento {
  id        String       @id @default(uuid())
  usuarioId String
  tipo      DocumentType
  url       String
  uploadedAt DateTime    @default(now())
  usuario   Usuario      @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
}

model Log {
  id        String   @id @default(uuid())
  usuarioId String
  accion    String
  detalles  Json?
  fecha     DateTime @default(now())
  usuario   Usuario  @relation(fields: [usuarioId], references: [id])
}

enum DocumentType {
  CREDENCIAL_UNIVERSITARIA
  CARTA_RESPONSIVA
  CERTIFICADO_MEDICO
  INE_TUTOR
}